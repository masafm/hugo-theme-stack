<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Lenovo on mkashi.com</title><link>https://mkashi.com/tags/lenovo/</link><description>Recent content in Lenovo on mkashi.com</description><generator>Hugo -- gohugo.io</generator><language>ja</language><lastBuildDate>Fri, 02 Apr 2021 10:17:25 +0900</lastBuildDate><atom:link href="https://mkashi.com/tags/lenovo/index.xml" rel="self" type="application/rss+xml"/><item><title>Lenovo m75s small gen2でNTPサーバーと同期できない</title><link>https://mkashi.com/p/lenovo-m75s-small-gen2%E3%81%A7ntp%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%A8%E5%90%8C%E6%9C%9F%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84/</link><pubDate>Fri, 02 Apr 2021 10:17:25 +0900</pubDate><guid>https://mkashi.com/p/lenovo-m75s-small-gen2%E3%81%A7ntp%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%A8%E5%90%8C%E6%9C%9F%E3%81%A7%E3%81%8D%E3%81%AA%E3%81%84/</guid><description>&lt;p>NTPはクライアント側のローカルに持っているハードウェアクロックとNTPサーバ側の時刻情報をしばらく比較した後に、NTPサーバ側がクライアントをrejectするかどうか決めるようである。その時にクライアント側のハードウェアクロックがあまりにも精度が悪いとサーバとの距離が遠いと判断されてflash=400 peer_distとしてrejectされる。jitterの値も1198.290と非常に高い。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@m75s-1-host ~]# ntpq -c as
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ind assid status conf reach auth condition last_event cnt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">===========================================================
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1 47715 9024 yes yes none reject reachable 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@m75s-1-host ~]# ntpq -c &amp;#34;rv 47715&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">associd=47715 status=9024 conf, reach, sel_reject, 2 events, reachable,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">srcadr=raspberrypi.mkashi.com, srcport=123, dstadr=192.168.151.241,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dstport=123, leap=00, stratum=2, precision=-18, rootdelay=3.922,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rootdisp=5.783, refid=133.243.238.164,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">reftime=e4118348.66206e7a Fri, Apr 2 2021 11:49:28.398,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rec=e41183d1.b1b84388 Fri, Apr 2 2021 11:51:45.694, reach=037,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">unreach=0, hmode=3, pmode=4, hpoll=6, ppoll=6, headway=1,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">flash=400 peer_dist, keyid=0, offset=1869.194, delay=0.979,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dispersion=438.293, jitter=1198.290, xleave=0.265,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">filtdelay= 0.98 0.94 0.67 0.43 1.05 0.00 0.00 0.00,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">filtoffset= 1869.19 1441.02 1006.12 557.80 109.76 0.00 0.00 0.00,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">filtdisp= 0.00 0.96 1.94 2.94 3.95 16000.0 16000.0 16000.0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ハードウェアクロックはm75sだとtsc, hpet, acpi_pmの中から選べる。tscが一番精度が高いのでtscがデフォルトになっているようである。ただm75sではtscの精度が悪く、実際の時間に比べてめちゃくちゃ進むのが遅くてNTPサーバから距離が遠いと判断されてしまうようだ。hpetだと問題なく同期できるようになるのでkernelの起動パラメータに&lt;code>clocksource=hpet&lt;/code>を設定する。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@m75s-1-host ~]# cat /sys/devices/system/clocksource/clocksource0/available_clocksource
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tsc hpet acpi_pm
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@m75s-1-host ~]# cat /sys/devices/system/clocksource/clocksource0/current_clocksource
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tsc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>hpetに変更後は下記の通りNTPサーバと同期できるようになった。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[root@m75s-1-host ~]# ntpq -c as
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ind assid status conf reach auth condition last_event cnt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">===========================================================
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1 35947 963a yes yes none sys.peer sys_peer 3
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[root@m75s-1-host ~]# ntpq -c &amp;#34;rv 35947&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">associd=35947 status=963a conf, reach, sel_sys.peer, 3 events, sys_peer,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">srcadr=raspberrypi.mkashi.com, srcport=123, dstadr=192.168.151.241,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dstport=123, leap=00, stratum=2, precision=-18, rootdelay=4.929,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rootdisp=29.007, refid=133.243.238.164,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">reftime=e4125f84.662e55a0 Sat, Apr 3 2021 3:29:08.399,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rec=e4126306.366cee04 Sat, Apr 3 2021 3:44:06.212, reach=377,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">unreach=0, hmode=3, pmode=4, hpoll=9, ppoll=9, headway=0, flash=00 ok,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">keyid=0, offset=0.164, delay=0.866, dispersion=11.731, jitter=0.211,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">xleave=0.235,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">filtdelay= 1.02 0.87 1.11 0.99 1.80 1.01 0.98 1.01,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">filtoffset= 0.24 0.16 0.08 -0.12 0.15 -0.09 -0.09 -0.13,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">filtdisp= 0.01 4.03 8.08 12.07 16.12 19.99 23.86 27.86
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>kernel 4.19.84-2.el7.nutanix.20190916.276.x86_64ではtscで同期できなかったが、5.8.0-55-genericでは特に問題なくデフォルトのままで同期できた。kernelのバグかもしれない。&lt;/p>
&lt;p>参考: &lt;a class="link" href="http://log.or.cz/?p=80" target="_blank" rel="noopener"
>http://log.or.cz/?p=80&lt;/a>&lt;/p></description></item><item><title>Lenovo m75s gen2でkernelにACS overrideパッチを当ててIOMMUグループを分割する</title><link>https://mkashi.com/p/lenovo-m75s-gen2%E3%81%A7kernel%E3%81%ABacs-override%E3%83%91%E3%83%83%E3%83%81%E3%82%92%E5%BD%93%E3%81%A6%E3%81%A6iommu%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%82%92%E5%88%86%E5%89%B2%E3%81%99%E3%82%8B/</link><pubDate>Sun, 28 Mar 2021 10:18:25 +0900</pubDate><guid>https://mkashi.com/p/lenovo-m75s-gen2%E3%81%A7kernel%E3%81%ABacs-override%E3%83%91%E3%83%83%E3%83%81%E3%82%92%E5%BD%93%E3%81%A6%E3%81%A6iommu%E3%82%B0%E3%83%AB%E3%83%BC%E3%83%97%E3%82%92%E5%88%86%E5%89%B2%E3%81%99%E3%82%8B/</guid><description>&lt;p>使用しているkernelはNutanix CEのAHVに付属の4.19.84-2.el7.nutanix.20190916.276.x86_64。基本的にRHEL7のものと同じと思われる。&lt;/p>
&lt;p>ACS overrideを有効にすることで内蔵のSATAコントローラのIOMMUグループが12に変わり他のPCIデバイスが同じグループ内にない状態になったので、CVMにSATAコントローラ単体でパススルーすることができるようになった。ACS overrideがないとホスト側に必要なPCIデバイスまでパススルーされてしまいホストごとパニックしてしまう。&lt;/p>
&lt;p>ACS overrideパッチ適用前&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">IOMMU Group 0 00:01.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Renoir PCIe Dummy Host Bridge [1022:1632]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 10 02:00.0 USB controller [0c03]: Advanced Micro Devices, Inc. [AMD] Device [1022:43ef]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 10 02:00.1 SATA controller [0106]: Advanced Micro Devices, Inc. [AMD] Device [1022:43eb]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 10 02:00.2 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Device [1022:43e9]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 10 03:00.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Device [1022:43ea]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 10 03:01.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Device [1022:43ea]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 10 03:02.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Device [1022:43ea]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 10 03:03.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Device [1022:43ea]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 10 03:04.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Device [1022:43ea]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 10 03:08.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Device [1022:43ea]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 10 03:09.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Device [1022:43ea]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 10 07:00.0 USB controller [0c03]: Renesas Technology Corp. uPD720202 USB 3.0 Host Controller [1912:0015] (rev 02)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 10 09:00.0 Ethernet controller [0200]: Realtek Semiconductor Co., Ltd. RTL8111/8168/8411 PCI Express Gigabit Ethernet Controller [10ec:8168] (rev 0e)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 11 0b:00.0 Non-Volatile memory controller [0108]: Samsung Electronics Co Ltd NVMe SSD Controller SM981/PM981/PM983 [144d:a808]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 1 00:01.1 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Renoir PCIe GPP Bridge [1022:1633]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 2 00:02.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Renoir PCIe Dummy Host Bridge [1022:1632]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 3 00:02.1 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Renoir PCIe GPP Bridge [1022:1634]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 4 00:02.2 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Renoir PCIe GPP Bridge [1022:1634]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 5 00:08.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Renoir PCIe Dummy Host Bridge [1022:1632]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 5 00:08.1 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Renoir Internal PCIe GPP Bridge to Bus [1022:1635]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 5 0c:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Renoir [1002:1636] (rev d8)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 5 0c:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] Device [1002:1637]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 5 0c:00.2 Encryption controller [1080]: Advanced Micro Devices, Inc. [AMD] Family 17h (Models 10h-1fh) Platform Security Processor [1022:15df]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 5 0c:00.3 USB controller [0c03]: Advanced Micro Devices, Inc. [AMD] Renoir USB 3.1 [1022:1639]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 5 0c:00.4 USB controller [0c03]: Advanced Micro Devices, Inc. [AMD] Renoir USB 3.1 [1022:1639]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 5 0c:00.5 Multimedia controller [0480]: Advanced Micro Devices, Inc. [AMD] Raven/Raven2/FireFlight/Renoir Audio Processor [1022:15e2] (rev 01)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 5 0c:00.6 Audio device [0403]: Advanced Micro Devices, Inc. [AMD] Family 17h (Models 10h-1fh) HD Audio Controller [1022:15e3]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 6 00:14.0 SMBus [0c05]: Advanced Micro Devices, Inc. [AMD] FCH SMBus Controller [1022:790b] (rev 51)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 6 00:14.3 ISA bridge [0601]: Advanced Micro Devices, Inc. [AMD] FCH LPC Bridge [1022:790e] (rev 51)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 7 00:18.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Renoir Device 24: Function 0 [1022:1448]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 7 00:18.1 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Renoir Device 24: Function 1 [1022:1449]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 7 00:18.2 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Renoir Device 24: Function 2 [1022:144a]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 7 00:18.3 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Renoir Device 24: Function 3 [1022:144b]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 7 00:18.4 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Renoir Device 24: Function 4 [1022:144c]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 7 00:18.5 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Renoir Device 24: Function 5 [1022:144d]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 7 00:18.6 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Renoir Device 24: Function 6 [1022:144e]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 7 00:18.7 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Renoir Device 24: Function 7 [1022:144f]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 8 01:00.0 Ethernet controller [0200]: Intel Corporation 82599ES 10-Gigabit SFI/SFP+ Network Connection [8086:10fb] (rev 01)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 9 01:00.1 Ethernet controller [0200]: Intel Corporation 82599ES 10-Gigabit SFI/SFP+ Network Connection [8086:10fb] (rev 01)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ACS overrideパッチ適用後
&lt;code>pcie_acs_override=downstream,multifunction&lt;/code>を設定して再起動&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">IOMMU Group 0 00:01.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Renoir PCIe Dummy Host Bridge [1022:1632]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 10 01:00.1 Ethernet controller [0200]: Intel Corporation 82599ES 10-Gigabit SFI/SFP+ Network Connection [8086:10fb] (rev 01)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 11 02:00.0 USB controller [0c03]: Advanced Micro Devices, Inc. [AMD] Device [1022:43ef]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 12 02:00.1 SATA controller [0106]: Advanced Micro Devices, Inc. [AMD] Device [1022:43eb]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 13 02:00.2 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Device [1022:43e9]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 14 03:00.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Device [1022:43ea]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 15 03:01.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Device [1022:43ea]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 16 03:02.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Device [1022:43ea]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 17 03:03.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Device [1022:43ea]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 18 03:04.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Device [1022:43ea]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 19 03:08.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Device [1022:43ea]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 1 00:01.1 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Renoir PCIe GPP Bridge [1022:1633]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 20 03:09.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Device [1022:43ea]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 21 07:00.0 USB controller [0c03]: Renesas Technology Corp. uPD720202 USB 3.0 Host Controller [1912:0015] (rev 02)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 22 09:00.0 Ethernet controller [0200]: Realtek Semiconductor Co., Ltd. RTL8111/8168/8411 PCI Express Gigabit Ethernet Controller [10ec:8168] (rev 0e)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 23 0b:00.0 Non-Volatile memory controller [0108]: Samsung Electronics Co Ltd NVMe SSD Controller SM981/PM981/PM983 [144d:a808]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 24 0c:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Renoir [1002:1636] (rev d8)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 25 0c:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] Device [1002:1637]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 26 0c:00.2 Encryption controller [1080]: Advanced Micro Devices, Inc. [AMD] Family 17h (Models 10h-1fh) Platform Security Processor [1022:15df]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 27 0c:00.3 USB controller [0c03]: Advanced Micro Devices, Inc. [AMD] Renoir USB 3.1 [1022:1639]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 28 0c:00.4 USB controller [0c03]: Advanced Micro Devices, Inc. [AMD] Renoir USB 3.1 [1022:1639]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 29 0c:00.5 Multimedia controller [0480]: Advanced Micro Devices, Inc. [AMD] Raven/Raven2/FireFlight/Renoir Audio Processor [1022:15e2] (rev 01)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 2 00:02.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Renoir PCIe Dummy Host Bridge [1022:1632]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 30 0c:00.6 Audio device [0403]: Advanced Micro Devices, Inc. [AMD] Family 17h (Models 10h-1fh) HD Audio Controller [1022:15e3]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 3 00:02.1 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Renoir PCIe GPP Bridge [1022:1634]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 4 00:02.2 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Renoir PCIe GPP Bridge [1022:1634]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 5 00:08.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Renoir PCIe Dummy Host Bridge [1022:1632]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 6 00:08.1 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD] Renoir Internal PCIe GPP Bridge to Bus [1022:1635]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 7 00:14.0 SMBus [0c05]: Advanced Micro Devices, Inc. [AMD] FCH SMBus Controller [1022:790b] (rev 51)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 7 00:14.3 ISA bridge [0601]: Advanced Micro Devices, Inc. [AMD] FCH LPC Bridge [1022:790e] (rev 51)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 8 00:18.0 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Renoir Device 24: Function 0 [1022:1448]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 8 00:18.1 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Renoir Device 24: Function 1 [1022:1449]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 8 00:18.2 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Renoir Device 24: Function 2 [1022:144a]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 8 00:18.3 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Renoir Device 24: Function 3 [1022:144b]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 8 00:18.4 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Renoir Device 24: Function 4 [1022:144c]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 8 00:18.5 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Renoir Device 24: Function 5 [1022:144d]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 8 00:18.6 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Renoir Device 24: Function 6 [1022:144e]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 8 00:18.7 Host bridge [0600]: Advanced Micro Devices, Inc. [AMD] Renoir Device 24: Function 7 [1022:144f]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">IOMMU Group 9 01:00.0 Ethernet controller [0200]: Intel Corporation 82599ES 10-Gigabit SFI/SFP+ Network Connection [8086:10fb] (rev 01)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>参考: &lt;a class="link" href="https://wiki.archlinux.jp/index.php/OVMF_%e3%81%ab%e3%82%88%e3%82%8b_PCI_%e3%83%91%e3%82%b9%e3%82%b9%e3%83%ab%e3%83%bc#IOMMU_.E3.82.B0.E3.83.AB.E3.83.BC.E3.83.97.E3.81.AE.E3.83.90.E3.82.A4.E3.83.91.E3.82.B9_.28ACS_.E4.B8.8A.E6.9B.B8.E3.81.8D.E3.83.91.E3.83.83.E3.83.81.29" target="_blank" rel="noopener"
>archlinux wiki&lt;/a>&lt;/p></description></item><item><title>Lenovo m75s gen2 smallにNutanix CE 2020.09.16を入れる</title><link>https://mkashi.com/p/lenovo-m75s-gen2-small%E3%81%ABnutanix-ce-2020.09.16%E3%82%92%E5%85%A5%E3%82%8C%E3%82%8B/</link><pubDate>Sun, 28 Mar 2021 10:17:25 +0900</pubDate><guid>https://mkashi.com/p/lenovo-m75s-gen2-small%E3%81%ABnutanix-ce-2020.09.16%E3%82%92%E5%85%A5%E3%82%8C%E3%82%8B/</guid><description>&lt;p>インストール前に下記のスライドは必読
&lt;a class="link" href="https://www.slideshare.net/smzksts/nutanix-community-edition-518" target="_blank" rel="noopener"
>https://www.slideshare.net/smzksts/nutanix-community-edition-518&lt;/a>&lt;/p>
&lt;p>ドライブ構成はUSBメモリ(AHV), NVMe(CVM), SATA SSD(CVM), SATA HDD(DATA)
m75s gen2で躓いたポイントは以下&lt;/p>
&lt;ul>
&lt;li>USBからブート後、一度USBを抜き差ししないと&lt;code>StandardError: Failed command: [hdparm -z /dev/sdc] with reason [BLKRRPART failed: Device or resource busy]&lt;/code>というメッセージが出てインストーラが起動しない&lt;/li>
&lt;li>上記スライド p19 「インストール準備 起動優先度の設定 • に入り、 起動デバイスの優先順位を変更し、 インストーラー メモリが 最上位となるように設定する • キーや キー等 機種によって異なる で 入れるブートデバイス手動選択画面から 起動すると、なぜかスクリーンサイズ不足に なってしまい、インストールを続行できない （報告多数）」に従ってもインストールが続行できなかった。しょうがないのでUSB NIC(QNA-UC5G1T)をつないでsshdを起動し./ce_installer &amp;amp;&amp;amp; screen -rでインストールを行った。&lt;/li>
&lt;li>CVM用にNVMeを選択した場合は、NVMeのメーカーによってはインストール後、CVMのブートに失敗する。Transcend TS512GMTE110Sだと失敗、Samsung 970 EVOだと成功した。これはTS512GMTE110Sに採用されてるSMIのコントローラチップのバグのせいっぽい。https://bugzilla.kernel.org/show_bug.cgi?id=20205&lt;/li>
&lt;/ul>
&lt;p>起動失敗時はQemuのログを見ると下記のようなメッセージが出ていた。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">qemu-system-x86_64: -device vfio-pci,host=01:00.0,id=hostdev2,bus=pci.0,addr=0x8: vfio error: 0000:01:00.0: failed to add PCI capability 0x11[0x50]@0xb0: table &amp;amp; pba overlap, or they don&amp;#39;t fit in BARs, or don&amp;#39;t align
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item></channel></rss>